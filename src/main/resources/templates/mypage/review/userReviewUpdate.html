<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="import/cssImport.html :: css-import"></div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
		var rating = '[[${review.reviewRating}]]';
		if(rating != null){
			$("#star" + rating).parent().children('button').removeClass('on');
			$("#star" + rating).addClass('on').prevAll('button').addClass('on');
		}
	   	$('.star_rating > .star').click(function() {
		  $(this).parent().children('button').removeClass('on');
		  $(this).addClass('on').prevAll('button').addClass('on');
		  rating =  $(this).val();
s		});
		
    	$("#cancelBtn").on("click", function(){
    		if(confirm("í›„ê¸° ìˆ˜ì •ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
    			window.self.close();
    		}
    	});
    	
    	$("#updateBtn").on("click", function(){
    		if(rating == ''){
    			alert("í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ ë³„ì ìœ¼ë¡œ í‰ê°€í•´ì£¼ì„¸ìš”!");
    			return;
    		}
			if($.trim($("#reviewContents").val()).length <= 0){
				alert("ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
				return;
			}
			var formData = new FormData();
			formData.append("rating", rating);
			formData.append("reviewId", '[[${review.reviewId}]]');
			formData.append("reviewContents", $("#reviewContents").val());
			$.ajax({
				url:"/user/userReview",
				method:"PUT",
				data:formData,
				processData : false,
	            contentType : false,
	            cache: false,
	            enctype: 'multipart/form-data',  
				success:function(){
					alert("í›„ê¸°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
					window.self.close();
					opener.parent.location.reload();
				},
				error:function(){
					alert("í›„ê¸° ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
					console.log("Update Fail");
					window.self.close();
					opener.parent.location.reload();
				}
			});
    	});
    });
    </script>
</head>
<body style="height:630px;">
<section class="review-section">
	<div class="row review-title-area py-3 mb-4">
		<h3 class="d-flex mb-2 review-title">ğŸ˜Š ìˆ˜ê°• í›„ê¸° ìˆ˜ì • ğŸ˜Š</h3>
	</div>
	<div class="row review-info-area mt-2">
		<th:block th:if="${classIden} == 'ON'">
			<div><img class="img" th:src="@{'/images/onlineThumbnail/' + ${class.onlineClassId} + '.jpg'}"></div>
			<div><h5 class="mt-3 title">[[${class.onlineClassTitle}]]</h5>
		</th:block>
		<th:block th:if="${classIden} == 'OFF'">
			<div><img class="img" th:src="@{'/images/offlineThumbnail/' + ${class.offlineClassId} + '.jpg'}"></div>
			<div><h5 class="mt-3 title">[[${class.offlineClassTitle}]]</h5>
		</th:block>
		<h6 class="mb-0">[[${class.category} + ' | ' + ${class.instructorNickname}]]</h6></div>
	</div>
	<div class="row review-input-area">
		<div class=" star_rating">
		  <span class="text mr-1">ë³„ì  : </span>
			  <button class="star" id="star1" value="1" > </button>
			  <button class="star" id="star2" value="2" > </button>
			  <button class="star" id="star3" value="3" > </button>
			  <button class="star" id="star4" value="4" > </button>
			  <button class="star" id="star5" value="5" > </button>
		</div>
		<div class="textarea">
			<textarea class="text" id="reviewContents" cols="60" rows="7" th:placeholder="|${userNickname}ë‹˜! í›„ê¸° ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.|">[[${review.reviewContent}]]</textarea>
			<div class="review-view-third col-12 mr-0">[[${#temporals.format(review.reviewRegdate, 'yyyy/MM/dd HH:mm')}]]</div>
		</div>
	</div>
	<div class="row review-button-area mt-4">
		<button type="button" class="my-lectureBtn mx-1" id="cancelBtn">ì·¨ì†Œ</button>
		<button type="button" class="my-lectureBtn mx-1" id="updateBtn">ìˆ˜ì •</button>
	</div>
</section>
</body>
</html>