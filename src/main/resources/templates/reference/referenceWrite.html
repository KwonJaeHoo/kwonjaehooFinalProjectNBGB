<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="import/cssImport.html :: css-import"></div>
	<link rel="stylesheet" href="/css/reference.css" >
<script type="text/javascript">
$(document).ready(function(){
    $("#btnSubmit").on("click", function(e){
        e.preventDefault(); // 폼의 기본 제출 동작 방지

        if($.trim($("#refTitle").val()).length <= 0) {
            $("#refTitle").val("");
            $("#refTitle").focus();
            alert("문의 제목을 입력하세요.");
            return;
        }
        
        if($.trim($("#refContent").val()).length <= 0) {
            $("#refContent").val("");
            $("#refContent").focus();
            alert("문의 내용을 입력하세요.");
            return;
        }

        var formData = new FormData();

        // 서버에 바인딩될 수 있도록 개별 필드 추가
        formData.append('refTitle', $("#refTitle").val());
        formData.append('refContent', $("#refContent").val());
        formData.append('userId', $("#userId").val()); // 사용자 아이디 추가
        
        $.ajax({
            type: "POST",
            url: "/reference/referenceWrite/post",
            enctype: "multipart/form-data",
            data: formData,
            processData: false,
            contentType: false,
            cache: false,
            beforeSend: function(xhr){
                xhr.setRequestHeader("AJAX", "true");
            },
            success: function(data)
            {
                alert("문의글이 등록되었습니다.");
                document.location.href = document.location.href;
            },
            error: function(xhr, status, error){
                alert("오류가 발생했습니다.");
            }
        });
    });
});
</script>
</head>
<body>
	<!--사용자 네비게이션-->
	<!--메뉴 네비게이션-->
	<div th:insert="import/topImport.html :: top-import"></div>
	
	<a class="MainBanner" aria-current="page"><h1>문의글 작성하기</h1></a>
	
	
	<div class="container">

    <form method="post">

        <div>
            <input type="hidden" id="name" class="form-control" value="testUser" placeholder="제목을 입력하세요.">

        </div>

        <div>
            <label for="refTitle">제목</label>
            <input type="text" id="refTitle" name="refTitle" class="form-control" placeholder="제목을 입력하세요.">
        </div>
        <div>
        	<label for="userId">아이디</label>
        	<input type="text" id="userId" name="userId" 
       		th:value="${#authentication.principal.username}" class="form-control" placeholder="" readonly
       		style="width: 50%; background-color: #A4A4A4;">
        </div>
        <div>
            <label for="refContent">내용</label>
            <textarea cols="150" rows="10" id="refContent" name="refContent" class="form-control" placeholder="내용을 입력하세요.">

            </textarea>

        </div>

        <hr class="my-4">

        <div class="row">
            <div class="col">
                <button class="w-100 btn btn-primary btn-lg" type="submit" id="btnSubmit" name="btnSubmit">저장</button>
            </div>
            <div class="col">
                <button class="w-100 btn btn-secondary btn-lg"
                        type="button">취소</button>
            </div>
        </div>

    </form>

</div> <!-- /container -->
	
	
	<!--채팅/맨 위로 버튼-->
		<!--footer-->
			<!-- loader -->
	<div th:insert="import/bottomImport.html :: bottom-import"></div>
			<!-- loader -->
		<!--footer-->
	<!--채팅/맨 위로 버튼-->
	
	<div th:replace="import/jsImport.html :: js-import"></div>
</body>
</html>